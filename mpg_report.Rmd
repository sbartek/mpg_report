---
title: "Report on Fuel Consumption of automobiles"
date: "May 13th, 2015"
output: rmarkdown::tufte_handout
---

```{r loads.libraries, echo=FALSE}
require('ggplot2')
require('data.table')
require('ggthemes')
require('leaps')
require('xtable')


cs.dt <- data.table(mtcars)
cs.dt$am <- as.factor(cs.dt$am)
cs.dt$cyl <- as.factor(cs.dt$cyl)
cs.dt$gear <- as.factor(cs.dt$gear)
cs.dt$vs <- as.factor(cs.dt$vs)
cs.dt$carb <- as.factor(cs.dt$carb)
```

# Introduction

We investigate data that extracted from the 1974 _Motor Trend_ US
magazine. They comprises fuel consumption and 10 aspects of automobile
design and performance for 32 automobiles (1973-74 models). We are
particularly interested in the following questions:

* Is an automatic or manual transmission better for MPG?
* Quantify the MPG difference between automatic and manual
  transmissions.

```{r boxplot1, fig.margin = TRUE, fig.cap = "Automatic vs. manual transmission."}
ggplot(cs.dt, aes(am, mpg)) + geom_boxplot() + theme_tufte() +
            scale_x_discrete(labels=c("manual", "automatic"))
```
```{r WTGimpact, fig.margin = TRUE, fig.cap = "Impact of weight, transmission and number of cylinders on fuel consumption."}
ggplot(cs.dt, aes(wt, mpg, colour=am)) + geom_point() + theme_tufte() +
    geom_text(aes(label=cyl, colour=NULL), vjust=-0.6) +
        geom_smooth(method='lm')
```

The boxplot on Figure 1 suggests that manual transmission is better
for mpg. However, Figure 2 shows that actually weight or number of
gears can be the most important factor.


# Model Selection

Let us try to identify the subset of the predictors that can be
related to the mpg response. For that we use `regsubsets` function
from `leaps` library which select the best model with \(n\) predictors,
for \(n=1 \ldots 8\). 
```{r selection, results='asis'}
regfit <- regsubsets(mpg~. ,cs.dt)
reg.summary <- summary(regfit)
print(xtable(reg.summary$outmat), size="\\tiny")
```
```{r r2statistic, fig.margin=TRUE, fig.cap="$R^2$ statistic for the best model with $n=1,\\ldots, 8$."} 
ggplot(data=NULL, aes(x=1:length(reg.summary$rsq), y=reg.summary$rsq)) +
    geom_line() + theme_tufte() +
    labs(x='n', y="R2 statistic")
```
If we take a look at Figure 3 where we plot $R^2$ statistic for the
best model with $n=1,..., 8$ predictors, we see that $n=5$ would be
the best choice. Therefore our regression model is the following.

```{r 5predictors, results='asis'} 
fit <- lm(mpg~ hp + wt + am + I(cyl==6) + I(vs==1), data=cs.dt)
print(xtable(summary(fit)$coefficients),size="\\small")
```

## Is an automatic or manual transmission better for MPG?

```{r weightVsAm, fig.margin=TRUE, fig.cap="Boxplots of weight"}
ggplot(cs.dt, aes(x=am,y=wt)) + geom_boxplot() + theme_tufte()
```

In my opinion the results are not conclusive. This regression model
suggest that actually the most significant is characteristics are
horsepower and weight. One can clearly see that the more heavy cars
have automatic transmission (Figure 4). This could be an effect of
that economic car (in the sense of price) are smaller and tends to
have manual transmission while luxury cars are bigger and its
transmission is automatic.

## The MPG difference between automatic and manual transmissions

The difference is clearly visible on Figure 1. Let us do however
_t-test_ to test if the difference in mean is significant. 

## Appendix

```{r, fig.width = 12, fig.height=10, fig.fullwidth = TRUE, fig.cap = "Full width figure"}

pairs(cs.dt[,.(mpg,cyl, disp, hp, drat, wt, qsec, vs, am, gear, carb)], panel = panel.smooth)
```

```{r, fig.cap = "Sepal length vs. petal length, colored by species"}

ggplot(cs.dt, aes(hp, mpg, colour=am)) +
    geom_point() +
        geom_text(aes(label=cyl, colour=NULL), vjust=-0.6) +
        theme_tufte() +
            geom_smooth(method='lm')

ggplot(cs.dt, aes(hp, wt, colour=am)) +
    geom_point() +
        geom_text(aes(label=cyl, colour=NULL), vjust=-0.6) +
        theme_tufte() +
            geom_smooth(method='lm')


ggplot(cs.dt, aes(disp, mpg, colour=am)) +
    geom_point() +
        theme_tufte() +
            geom_smooth(method='lm')

ggplot(cs.dt, aes(wt, disp, colour=am)) +
    geom_point() +
        theme_tufte() +
            geom_smooth(method='lm')


```

[^git]: https://github.com/sbartek/mpg_report










